{"ast":null,"code":"// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { memo } from \"../util/index.js\";\nimport { filterBountiesProposals } from \"./helpers/filterBountyProposals.js\";\n\nfunction parseResult([maybeBounties, maybeDescriptions, ids, bountyProposals]) {\n  const bounties = [];\n  maybeBounties.forEach((bounty, index) => {\n    if (bounty.isSome) {\n      bounties.push({\n        bounty: bounty.unwrap(),\n        description: maybeDescriptions[index].unwrapOrDefault().toUtf8(),\n        index: ids[index],\n        proposals: bountyProposals.filter(bountyProposal => ids[index].eq(bountyProposal.proposal.args[0]))\n      });\n    }\n  });\n  return bounties;\n}\n\nexport function bounties(instanceId, api) {\n  const bountyBase = api.query.bounties || api.query.treasury;\n  return memo(instanceId, () => combineLatest([bountyBase.bountyCount(), api.query.council ? api.query.council.proposalCount() : of(0)]).pipe(switchMap(() => combineLatest([bountyBase.bounties.keys(), api.derive.council ? api.derive.council.proposals() : of([])])), switchMap(([keys, proposals]) => {\n    const ids = keys.map(({\n      args: [id]\n    }) => id);\n    return combineLatest([bountyBase.bounties.multi(ids), bountyBase.bountyDescriptions.multi(ids), of(ids), of(filterBountiesProposals(api, proposals))]);\n  }), map(parseResult)));\n}","map":{"version":3,"sources":["/home/abubakar/Desktop/KeyStore-Thorchain/node_modules/@polkadot/api-derive/bounties/bounties.js"],"names":["combineLatest","map","of","switchMap","memo","filterBountiesProposals","parseResult","maybeBounties","maybeDescriptions","ids","bountyProposals","bounties","forEach","bounty","index","isSome","push","unwrap","description","unwrapOrDefault","toUtf8","proposals","filter","bountyProposal","eq","proposal","args","instanceId","api","bountyBase","query","treasury","bountyCount","council","proposalCount","pipe","keys","derive","id","multi","bountyDescriptions"],"mappings":"AAAA;AACA;AACA,SAASA,aAAT,EAAwBC,GAAxB,EAA6BC,EAA7B,EAAiCC,SAAjC,QAAkD,MAAlD;AACA,SAASC,IAAT,QAAqB,kBAArB;AACA,SAASC,uBAAT,QAAwC,oCAAxC;;AAEA,SAASC,WAAT,CAAqB,CAACC,aAAD,EAAgBC,iBAAhB,EAAmCC,GAAnC,EAAwCC,eAAxC,CAArB,EAA+E;AAC7E,QAAMC,QAAQ,GAAG,EAAjB;AACAJ,EAAAA,aAAa,CAACK,OAAd,CAAsB,CAACC,MAAD,EAASC,KAAT,KAAmB;AACvC,QAAID,MAAM,CAACE,MAAX,EAAmB;AACjBJ,MAAAA,QAAQ,CAACK,IAAT,CAAc;AACZH,QAAAA,MAAM,EAAEA,MAAM,CAACI,MAAP,EADI;AAEZC,QAAAA,WAAW,EAAEV,iBAAiB,CAACM,KAAD,CAAjB,CAAyBK,eAAzB,GAA2CC,MAA3C,EAFD;AAGZN,QAAAA,KAAK,EAAEL,GAAG,CAACK,KAAD,CAHE;AAIZO,QAAAA,SAAS,EAAEX,eAAe,CAACY,MAAhB,CAAuBC,cAAc,IAAId,GAAG,CAACK,KAAD,CAAH,CAAWU,EAAX,CAAcD,cAAc,CAACE,QAAf,CAAwBC,IAAxB,CAA6B,CAA7B,CAAd,CAAzC;AAJC,OAAd;AAMD;AACF,GATD;AAUA,SAAOf,QAAP;AACD;;AAED,OAAO,SAASA,QAAT,CAAkBgB,UAAlB,EAA8BC,GAA9B,EAAmC;AACxC,QAAMC,UAAU,GAAGD,GAAG,CAACE,KAAJ,CAAUnB,QAAV,IAAsBiB,GAAG,CAACE,KAAJ,CAAUC,QAAnD;AACA,SAAO3B,IAAI,CAACuB,UAAD,EAAa,MAAM3B,aAAa,CAAC,CAAC6B,UAAU,CAACG,WAAX,EAAD,EAA2BJ,GAAG,CAACE,KAAJ,CAAUG,OAAV,GAAoBL,GAAG,CAACE,KAAJ,CAAUG,OAAV,CAAkBC,aAAlB,EAApB,GAAwDhC,EAAE,CAAC,CAAD,CAArF,CAAD,CAAb,CAAyGiC,IAAzG,CAA8GhC,SAAS,CAAC,MAAMH,aAAa,CAAC,CAAC6B,UAAU,CAAClB,QAAX,CAAoByB,IAApB,EAAD,EAA6BR,GAAG,CAACS,MAAJ,CAAWJ,OAAX,GAAqBL,GAAG,CAACS,MAAJ,CAAWJ,OAAX,CAAmBZ,SAAnB,EAArB,GAAsDnB,EAAE,CAAC,EAAD,CAArF,CAAD,CAApB,CAAvH,EAA0OC,SAAS,CAAC,CAAC,CAACiC,IAAD,EAAOf,SAAP,CAAD,KAAuB;AACvS,UAAMZ,GAAG,GAAG2B,IAAI,CAACnC,GAAL,CAAS,CAAC;AACpByB,MAAAA,IAAI,EAAE,CAACY,EAAD;AADc,KAAD,KAEfA,EAFM,CAAZ;AAGA,WAAOtC,aAAa,CAAC,CAAC6B,UAAU,CAAClB,QAAX,CAAoB4B,KAApB,CAA0B9B,GAA1B,CAAD,EAAiCoB,UAAU,CAACW,kBAAX,CAA8BD,KAA9B,CAAoC9B,GAApC,CAAjC,EAA2EP,EAAE,CAACO,GAAD,CAA7E,EAAoFP,EAAE,CAACG,uBAAuB,CAACuB,GAAD,EAAMP,SAAN,CAAxB,CAAtF,CAAD,CAApB;AACD,GALgR,CAAnP,EAK1BpB,GAAG,CAACK,WAAD,CALuB,CAAnB,CAAX;AAMD","sourcesContent":["// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { memo } from \"../util/index.js\";\nimport { filterBountiesProposals } from \"./helpers/filterBountyProposals.js\";\n\nfunction parseResult([maybeBounties, maybeDescriptions, ids, bountyProposals]) {\n  const bounties = [];\n  maybeBounties.forEach((bounty, index) => {\n    if (bounty.isSome) {\n      bounties.push({\n        bounty: bounty.unwrap(),\n        description: maybeDescriptions[index].unwrapOrDefault().toUtf8(),\n        index: ids[index],\n        proposals: bountyProposals.filter(bountyProposal => ids[index].eq(bountyProposal.proposal.args[0]))\n      });\n    }\n  });\n  return bounties;\n}\n\nexport function bounties(instanceId, api) {\n  const bountyBase = api.query.bounties || api.query.treasury;\n  return memo(instanceId, () => combineLatest([bountyBase.bountyCount(), api.query.council ? api.query.council.proposalCount() : of(0)]).pipe(switchMap(() => combineLatest([bountyBase.bounties.keys(), api.derive.council ? api.derive.council.proposals() : of([])])), switchMap(([keys, proposals]) => {\n    const ids = keys.map(({\n      args: [id]\n    }) => id);\n    return combineLatest([bountyBase.bounties.multi(ids), bountyBase.bountyDescriptions.multi(ids), of(ids), of(filterBountiesProposals(api, proposals))]);\n  }), map(parseResult)));\n}"]},"metadata":{},"sourceType":"module"}