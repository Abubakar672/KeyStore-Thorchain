{"ast":null,"code":"// m [pubKeys ...] n OP_CHECKMULTISIG\nvar bscript = require('../../script');\n\nvar types = require('../../types');\n\nvar typeforce = require('typeforce');\n\nvar OPS = require('@psf/bitcoincash-ops');\n\nvar OP_INT_BASE = OPS.OP_RESERVED; // OP_1 - 1\n\nfunction check(script, allowIncomplete) {\n  var chunks = bscript.decompile(script);\n  if (chunks.length < 4) return false;\n  if (chunks[chunks.length - 1] !== OPS.OP_CHECKMULTISIG) return false;\n  if (!types.Number(chunks[0])) return false;\n  if (!types.Number(chunks[chunks.length - 2])) return false;\n  var m = chunks[0] - OP_INT_BASE;\n  var n = chunks[chunks.length - 2] - OP_INT_BASE;\n  if (m <= 0) return false;\n  if (n > 16) return false;\n  if (m > n) return false;\n  if (n !== chunks.length - 3) return false;\n  if (allowIncomplete) return true;\n  var keys = chunks.slice(1, -2);\n  return keys.every(bscript.isCanonicalPubKey);\n}\n\ncheck.toJSON = function () {\n  return 'multi-sig output';\n};\n\nfunction encode(m, pubKeys) {\n  typeforce({\n    m: types.Number,\n    pubKeys: [bscript.isCanonicalPubKey]\n  }, {\n    m: m,\n    pubKeys: pubKeys\n  });\n  var n = pubKeys.length;\n  if (n < m) throw new TypeError('Not enough pubKeys provided');\n  return bscript.compile([].concat(OP_INT_BASE + m, pubKeys, OP_INT_BASE + n, OPS.OP_CHECKMULTISIG));\n}\n\nfunction decode(buffer, allowIncomplete) {\n  var chunks = bscript.decompile(buffer);\n  typeforce(check, chunks, allowIncomplete);\n  return {\n    m: chunks[0] - OP_INT_BASE,\n    pubKeys: chunks.slice(1, -2)\n  };\n}\n\nmodule.exports = {\n  check: check,\n  decode: decode,\n  encode: encode\n};","map":{"version":3,"sources":["/home/abubakar/Desktop/KeyStore-Thorchain/node_modules/@psf/bitcoincashjs-lib/src/templates/multisig/output.js"],"names":["bscript","require","types","typeforce","OPS","OP_INT_BASE","OP_RESERVED","check","script","allowIncomplete","chunks","decompile","length","OP_CHECKMULTISIG","Number","m","n","keys","slice","every","isCanonicalPubKey","toJSON","encode","pubKeys","TypeError","compile","concat","decode","buffer","module","exports"],"mappings":"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","sourcesContent":["// m [pubKeys ...] n OP_CHECKMULTISIG\n\nvar bscript = require('../../script')\nvar types = require('../../types')\nvar typeforce = require('typeforce')\nvar OPS = require('@psf/bitcoincash-ops')\nvar OP_INT_BASE = OPS.OP_RESERVED // OP_1 - 1\n\nfunction check (script, allowIncomplete) {\n  var chunks = bscript.decompile(script)\n\n  if (chunks.length < 4) return false\n  if (chunks[chunks.length - 1] !== OPS.OP_CHECKMULTISIG) return false\n  if (!types.Number(chunks[0])) return false\n  if (!types.Number(chunks[chunks.length - 2])) return false\n  var m = chunks[0] - OP_INT_BASE\n  var n = chunks[chunks.length - 2] - OP_INT_BASE\n\n  if (m <= 0) return false\n  if (n > 16) return false\n  if (m > n) return false\n  if (n !== chunks.length - 3) return false\n  if (allowIncomplete) return true\n\n  var keys = chunks.slice(1, -2)\n  return keys.every(bscript.isCanonicalPubKey)\n}\ncheck.toJSON = function () { return 'multi-sig output' }\n\nfunction encode (m, pubKeys) {\n  typeforce({\n    m: types.Number,\n    pubKeys: [bscript.isCanonicalPubKey]\n  }, {\n    m: m,\n    pubKeys: pubKeys\n  })\n\n  var n = pubKeys.length\n  if (n < m) throw new TypeError('Not enough pubKeys provided')\n\n  return bscript.compile([].concat(\n    OP_INT_BASE + m,\n    pubKeys,\n    OP_INT_BASE + n,\n    OPS.OP_CHECKMULTISIG\n  ))\n}\n\nfunction decode (buffer, allowIncomplete) {\n  var chunks = bscript.decompile(buffer)\n  typeforce(check, chunks, allowIncomplete)\n\n  return {\n    m: chunks[0] - OP_INT_BASE,\n    pubKeys: chunks.slice(1, -2)\n  }\n}\n\nmodule.exports = {\n  check: check,\n  decode: decode,\n  encode: encode\n}\n"]},"metadata":{},"sourceType":"script"}