{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n} // Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { isFunction } from '@polkadot/util';\nimport { memo } from \"../util/index.js\";\nimport { calcVotes, getStatus, parseImage } from \"./util.js\";\n\nfunction votesPrev(api, referendumId) {\n  return api.query.democracy.votersFor(referendumId).pipe(switchMap(votersFor => combineLatest([of(votersFor), votersFor.length ? api.query.democracy.voteOf.multi(votersFor.map(accountId => [referendumId, accountId])) : of([]), api.derive.balances.votingBalances(votersFor)])), map(([votersFor, votes, balances]) => votersFor.map((accountId, index) => ({\n    accountId,\n    balance: balances[index].votingBalance || api.registry.createType('Balance'),\n    isDelegating: false,\n    vote: votes[index] || api.registry.createType('Vote')\n  }))));\n}\n\nfunction extractVotes(mapped, referendumId) {\n  return mapped.filter(([, voting]) => voting.isDirect).map(([accountId, voting]) => [accountId, voting.asDirect.votes.filter(([idx]) => idx.eq(referendumId))]).filter(([, directVotes]) => !!directVotes.length).reduce((result, [accountId, votes]) => // FIXME We are ignoring split votes\n  votes.reduce((result, [, vote]) => {\n    if (vote.isStandard) {\n      result.push(_objectSpread({\n        accountId,\n        isDelegating: false\n      }, vote.asStandard));\n    }\n\n    return result;\n  }, result), []);\n}\n\nfunction votesCurr(api, referendumId) {\n  return api.query.democracy.votingOf.entries().pipe(map(allVoting => {\n    const mapped = allVoting.map(([{\n      args: [accountId]\n    }, voting]) => [accountId, voting]);\n    const votes = extractVotes(mapped, referendumId);\n    const delegations = mapped.filter(([, voting]) => voting.isDelegating).map(([accountId, voting]) => [accountId, voting.asDelegating]); // add delegations\n\n    delegations.forEach(([accountId, {\n      balance,\n      conviction,\n      target\n    }]) => {\n      // Are we delegating to a delegator\n      const toDelegator = delegations.find(([accountId]) => accountId.eq(target));\n      const to = votes.find(({\n        accountId\n      }) => accountId.eq(toDelegator ? toDelegator[0] : target)); // this delegation has a target\n\n      if (to) {\n        votes.push({\n          accountId,\n          balance,\n          isDelegating: true,\n          vote: api.registry.createType('Vote', {\n            aye: to.vote.isAye,\n            conviction\n          })\n        });\n      }\n    });\n    return votes;\n  }));\n}\n\nexport function _referendumVotes(instanceId, api) {\n  return memo(instanceId, referendum => combineLatest([api.derive.democracy.sqrtElectorate(), isFunction(api.query.democracy.votingOf) ? votesCurr(api, referendum.index) : votesPrev(api, referendum.index)]).pipe(map(([sqrtElectorate, votes]) => calcVotes(sqrtElectorate, referendum, votes))));\n}\nexport function _referendumsVotes(instanceId, api) {\n  return memo(instanceId, referendums => referendums.length ? combineLatest(referendums.map(referendum => api.derive.democracy._referendumVotes(referendum))) : of([]));\n}\nexport function _referendumInfo(instanceId, api) {\n  return memo(instanceId, (index, info) => {\n    const status = getStatus(info);\n    return status ? api.query.democracy.preimages(status.proposalHash).pipe(map(preimage => ({\n      image: parseImage(api, preimage),\n      imageHash: status.proposalHash,\n      index: api.registry.createType('ReferendumIndex', index),\n      status\n    }))) : of(null);\n  });\n}\nexport function referendumsInfo(instanceId, api) {\n  return memo(instanceId, ids => ids.length ? api.query.democracy.referendumInfoOf.multi(ids).pipe(switchMap(infos => combineLatest(ids.map((id, index) => api.derive.democracy._referendumInfo(id, infos[index])))), map(infos => infos.filter(referendum => !!referendum))) : of([]));\n}","map":{"version":3,"sources":["/home/abubakar/Desktop/KeyStore-Thorchain/node_modules/@polkadot/api-derive/democracy/referendumsInfo.js"],"names":["_defineProperty","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","combineLatest","map","of","switchMap","isFunction","memo","calcVotes","getStatus","parseImage","votesPrev","api","referendumId","query","democracy","votersFor","pipe","voteOf","multi","accountId","derive","balances","votingBalances","votes","index","balance","votingBalance","registry","createType","isDelegating","vote","extractVotes","mapped","voting","isDirect","asDirect","idx","eq","directVotes","reduce","result","isStandard","asStandard","votesCurr","votingOf","entries","allVoting","args","delegations","asDelegating","conviction","toDelegator","find","to","aye","isAye","_referendumVotes","instanceId","referendum","sqrtElectorate","_referendumsVotes","referendums","_referendumInfo","info","status","preimages","proposalHash","preimage","image","imageHash","referendumsInfo","ids","referendumInfoOf","infos","id"],"mappings":"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","sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { isFunction } from '@polkadot/util';\nimport { memo } from \"../util/index.js\";\nimport { calcVotes, getStatus, parseImage } from \"./util.js\";\n\nfunction votesPrev(api, referendumId) {\n  return api.query.democracy.votersFor(referendumId).pipe(switchMap(votersFor => combineLatest([of(votersFor), votersFor.length ? api.query.democracy.voteOf.multi(votersFor.map(accountId => [referendumId, accountId])) : of([]), api.derive.balances.votingBalances(votersFor)])), map(([votersFor, votes, balances]) => votersFor.map((accountId, index) => ({\n    accountId,\n    balance: balances[index].votingBalance || api.registry.createType('Balance'),\n    isDelegating: false,\n    vote: votes[index] || api.registry.createType('Vote')\n  }))));\n}\n\nfunction extractVotes(mapped, referendumId) {\n  return mapped.filter(([, voting]) => voting.isDirect).map(([accountId, voting]) => [accountId, voting.asDirect.votes.filter(([idx]) => idx.eq(referendumId))]).filter(([, directVotes]) => !!directVotes.length).reduce((result, [accountId, votes]) => // FIXME We are ignoring split votes\n  votes.reduce((result, [, vote]) => {\n    if (vote.isStandard) {\n      result.push(_objectSpread({\n        accountId,\n        isDelegating: false\n      }, vote.asStandard));\n    }\n\n    return result;\n  }, result), []);\n}\n\nfunction votesCurr(api, referendumId) {\n  return api.query.democracy.votingOf.entries().pipe(map(allVoting => {\n    const mapped = allVoting.map(([{\n      args: [accountId]\n    }, voting]) => [accountId, voting]);\n    const votes = extractVotes(mapped, referendumId);\n    const delegations = mapped.filter(([, voting]) => voting.isDelegating).map(([accountId, voting]) => [accountId, voting.asDelegating]); // add delegations\n\n    delegations.forEach(([accountId, {\n      balance,\n      conviction,\n      target\n    }]) => {\n      // Are we delegating to a delegator\n      const toDelegator = delegations.find(([accountId]) => accountId.eq(target));\n      const to = votes.find(({\n        accountId\n      }) => accountId.eq(toDelegator ? toDelegator[0] : target)); // this delegation has a target\n\n      if (to) {\n        votes.push({\n          accountId,\n          balance,\n          isDelegating: true,\n          vote: api.registry.createType('Vote', {\n            aye: to.vote.isAye,\n            conviction\n          })\n        });\n      }\n    });\n    return votes;\n  }));\n}\n\nexport function _referendumVotes(instanceId, api) {\n  return memo(instanceId, referendum => combineLatest([api.derive.democracy.sqrtElectorate(), isFunction(api.query.democracy.votingOf) ? votesCurr(api, referendum.index) : votesPrev(api, referendum.index)]).pipe(map(([sqrtElectorate, votes]) => calcVotes(sqrtElectorate, referendum, votes))));\n}\nexport function _referendumsVotes(instanceId, api) {\n  return memo(instanceId, referendums => referendums.length ? combineLatest(referendums.map(referendum => api.derive.democracy._referendumVotes(referendum))) : of([]));\n}\nexport function _referendumInfo(instanceId, api) {\n  return memo(instanceId, (index, info) => {\n    const status = getStatus(info);\n    return status ? api.query.democracy.preimages(status.proposalHash).pipe(map(preimage => ({\n      image: parseImage(api, preimage),\n      imageHash: status.proposalHash,\n      index: api.registry.createType('ReferendumIndex', index),\n      status\n    }))) : of(null);\n  });\n}\nexport function referendumsInfo(instanceId, api) {\n  return memo(instanceId, ids => ids.length ? api.query.democracy.referendumInfoOf.multi(ids).pipe(switchMap(infos => combineLatest(ids.map((id, index) => api.derive.democracy._referendumInfo(id, infos[index])))), map(infos => infos.filter(referendum => !!referendum))) : of([]));\n}"]},"metadata":{},"sourceType":"module"}