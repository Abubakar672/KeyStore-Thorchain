{"ast":null,"code":"// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { deriveCache, memo } from \"../util/index.js\";\nconst CACHE_KEY = 'eraPrefs';\n\nfunction mapPrefs(era, all) {\n  const validators = {};\n  all.forEach(([key, prefs]) => {\n    validators[key.args[1].toString()] = prefs;\n  });\n  return {\n    era,\n    validators\n  };\n}\n\nexport function _eraPrefs(instanceId, api) {\n  return memo(instanceId, (era, withActive) => {\n    const cacheKey = `${CACHE_KEY}-${era.toString()}`;\n    const cached = withActive ? undefined : deriveCache.get(cacheKey);\n    return cached ? of(cached) : api.query.staking.erasValidatorPrefs.entries(era).pipe(map(prefs => {\n      const value = mapPrefs(era, prefs);\n      !withActive && deriveCache.set(cacheKey, value);\n      return value;\n    }));\n  });\n}\nexport function eraPrefs(instanceId, api) {\n  return memo(instanceId, era => api.derive.staking._eraPrefs(era, true));\n}\nexport function _erasPrefs(instanceId, api) {\n  return memo(instanceId, (eras, withActive) => eras.length ? combineLatest(eras.map(era => api.derive.staking._eraPrefs(era, withActive))) : of([]));\n}\nexport function erasPrefs(instanceId, api) {\n  return memo(instanceId, (withActive = false) => api.derive.staking.erasHistoric(withActive).pipe(switchMap(eras => api.derive.staking._erasPrefs(eras, withActive))));\n}","map":{"version":3,"sources":["/home/abubakar/Desktop/KeyStore-Thorchain/node_modules/@polkadot/api-derive/staking/erasPrefs.js"],"names":["combineLatest","map","of","switchMap","deriveCache","memo","CACHE_KEY","mapPrefs","era","all","validators","forEach","key","prefs","args","toString","_eraPrefs","instanceId","api","withActive","cacheKey","cached","undefined","get","query","staking","erasValidatorPrefs","entries","pipe","value","set","eraPrefs","derive","_erasPrefs","eras","length","erasPrefs","erasHistoric"],"mappings":"AAAA;AACA;AACA,SAASA,aAAT,EAAwBC,GAAxB,EAA6BC,EAA7B,EAAiCC,SAAjC,QAAkD,MAAlD;AACA,SAASC,WAAT,EAAsBC,IAAtB,QAAkC,kBAAlC;AACA,MAAMC,SAAS,GAAG,UAAlB;;AAEA,SAASC,QAAT,CAAkBC,GAAlB,EAAuBC,GAAvB,EAA4B;AAC1B,QAAMC,UAAU,GAAG,EAAnB;AACAD,EAAAA,GAAG,CAACE,OAAJ,CAAY,CAAC,CAACC,GAAD,EAAMC,KAAN,CAAD,KAAkB;AAC5BH,IAAAA,UAAU,CAACE,GAAG,CAACE,IAAJ,CAAS,CAAT,EAAYC,QAAZ,EAAD,CAAV,GAAqCF,KAArC;AACD,GAFD;AAGA,SAAO;AACLL,IAAAA,GADK;AAELE,IAAAA;AAFK,GAAP;AAID;;AAED,OAAO,SAASM,SAAT,CAAmBC,UAAnB,EAA+BC,GAA/B,EAAoC;AACzC,SAAOb,IAAI,CAACY,UAAD,EAAa,CAACT,GAAD,EAAMW,UAAN,KAAqB;AAC3C,UAAMC,QAAQ,GAAI,GAAEd,SAAU,IAAGE,GAAG,CAACO,QAAJ,EAAe,EAAhD;AACA,UAAMM,MAAM,GAAGF,UAAU,GAAGG,SAAH,GAAelB,WAAW,CAACmB,GAAZ,CAAgBH,QAAhB,CAAxC;AACA,WAAOC,MAAM,GAAGnB,EAAE,CAACmB,MAAD,CAAL,GAAgBH,GAAG,CAACM,KAAJ,CAAUC,OAAV,CAAkBC,kBAAlB,CAAqCC,OAArC,CAA6CnB,GAA7C,EAAkDoB,IAAlD,CAAuD3B,GAAG,CAACY,KAAK,IAAI;AAC/F,YAAMgB,KAAK,GAAGtB,QAAQ,CAACC,GAAD,EAAMK,KAAN,CAAtB;AACA,OAACM,UAAD,IAAef,WAAW,CAAC0B,GAAZ,CAAgBV,QAAhB,EAA0BS,KAA1B,CAAf;AACA,aAAOA,KAAP;AACD,KAJsF,CAA1D,CAA7B;AAKD,GARU,CAAX;AASD;AACD,OAAO,SAASE,QAAT,CAAkBd,UAAlB,EAA8BC,GAA9B,EAAmC;AACxC,SAAOb,IAAI,CAACY,UAAD,EAAaT,GAAG,IAAIU,GAAG,CAACc,MAAJ,CAAWP,OAAX,CAAmBT,SAAnB,CAA6BR,GAA7B,EAAkC,IAAlC,CAApB,CAAX;AACD;AACD,OAAO,SAASyB,UAAT,CAAoBhB,UAApB,EAAgCC,GAAhC,EAAqC;AAC1C,SAAOb,IAAI,CAACY,UAAD,EAAa,CAACiB,IAAD,EAAOf,UAAP,KAAsBe,IAAI,CAACC,MAAL,GAAcnC,aAAa,CAACkC,IAAI,CAACjC,GAAL,CAASO,GAAG,IAAIU,GAAG,CAACc,MAAJ,CAAWP,OAAX,CAAmBT,SAAnB,CAA6BR,GAA7B,EAAkCW,UAAlC,CAAhB,CAAD,CAA3B,GAA8FjB,EAAE,CAAC,EAAD,CAAnI,CAAX;AACD;AACD,OAAO,SAASkC,SAAT,CAAmBnB,UAAnB,EAA+BC,GAA/B,EAAoC;AACzC,SAAOb,IAAI,CAACY,UAAD,EAAa,CAACE,UAAU,GAAG,KAAd,KAAwBD,GAAG,CAACc,MAAJ,CAAWP,OAAX,CAAmBY,YAAnB,CAAgClB,UAAhC,EAA4CS,IAA5C,CAAiDzB,SAAS,CAAC+B,IAAI,IAAIhB,GAAG,CAACc,MAAJ,CAAWP,OAAX,CAAmBQ,UAAnB,CAA8BC,IAA9B,EAAoCf,UAApC,CAAT,CAA1D,CAArC,CAAX;AACD","sourcesContent":["// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { deriveCache, memo } from \"../util/index.js\";\nconst CACHE_KEY = 'eraPrefs';\n\nfunction mapPrefs(era, all) {\n  const validators = {};\n  all.forEach(([key, prefs]) => {\n    validators[key.args[1].toString()] = prefs;\n  });\n  return {\n    era,\n    validators\n  };\n}\n\nexport function _eraPrefs(instanceId, api) {\n  return memo(instanceId, (era, withActive) => {\n    const cacheKey = `${CACHE_KEY}-${era.toString()}`;\n    const cached = withActive ? undefined : deriveCache.get(cacheKey);\n    return cached ? of(cached) : api.query.staking.erasValidatorPrefs.entries(era).pipe(map(prefs => {\n      const value = mapPrefs(era, prefs);\n      !withActive && deriveCache.set(cacheKey, value);\n      return value;\n    }));\n  });\n}\nexport function eraPrefs(instanceId, api) {\n  return memo(instanceId, era => api.derive.staking._eraPrefs(era, true));\n}\nexport function _erasPrefs(instanceId, api) {\n  return memo(instanceId, (eras, withActive) => eras.length ? combineLatest(eras.map(era => api.derive.staking._eraPrefs(era, withActive))) : of([]));\n}\nexport function erasPrefs(instanceId, api) {\n  return memo(instanceId, (withActive = false) => api.derive.staking.erasHistoric(withActive).pipe(switchMap(eras => api.derive.staking._erasPrefs(eras, withActive))));\n}"]},"metadata":{},"sourceType":"module"}