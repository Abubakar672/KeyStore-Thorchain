{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n} // Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n\nimport { BN, bnSqrt } from '@polkadot/util';\n\nfunction isOldInfo(info) {\n  return !!info.proposalHash;\n}\n\nfunction isCurrentStatus(status) {\n  return !!status.tally;\n}\n\nfunction isCurrentPreimage(api, imageOpt) {\n  return !!imageOpt && !api.query.democracy.dispatchQueue;\n}\n\nexport function compareRationals(n1, d1, n2, d2) {\n  while (true) {\n    const q1 = n1.div(d1);\n    const q2 = n2.div(d2);\n\n    if (q1.lt(q2)) {\n      return true;\n    } else if (q2.lt(q1)) {\n      return false;\n    }\n\n    const r1 = n1.mod(d1);\n    const r2 = n2.mod(d2);\n\n    if (r2.isZero()) {\n      return false;\n    } else if (r1.isZero()) {\n      return true;\n    }\n\n    n1 = d2;\n    n2 = d1;\n    d1 = r2;\n    d2 = r1;\n  }\n}\n\nfunction calcPassingOther(threshold, sqrtElectorate, {\n  votedAye,\n  votedNay,\n  votedTotal\n}) {\n  const sqrtVoters = bnSqrt(votedTotal);\n  return sqrtVoters.isZero() ? false : threshold.isSupermajorityapproval ? compareRationals(votedNay, sqrtVoters, votedAye, sqrtElectorate) : compareRationals(votedNay, sqrtElectorate, votedAye, sqrtVoters);\n}\n\nexport function calcPassing(threshold, sqrtElectorate, state) {\n  return threshold.isSimplemajority ? state.votedAye.gt(state.votedNay) : calcPassingOther(threshold, sqrtElectorate, state);\n}\n\nfunction calcVotesPrev(votesFor) {\n  return votesFor.reduce((state, derived) => {\n    const {\n      balance,\n      vote\n    } = derived;\n    const isDefault = vote.conviction.index === 0;\n    const counted = balance.muln(isDefault ? 1 : vote.conviction.index).divn(isDefault ? 10 : 1);\n\n    if (vote.isAye) {\n      state.allAye.push(derived);\n      state.voteCountAye++;\n      state.votedAye.iadd(counted);\n    } else {\n      state.allNay.push(derived);\n      state.voteCountNay++;\n      state.votedNay.iadd(counted);\n    }\n\n    state.voteCount++;\n    state.votedTotal.iadd(counted);\n    return state;\n  }, {\n    allAye: [],\n    allNay: [],\n    voteCount: 0,\n    voteCountAye: 0,\n    voteCountNay: 0,\n    votedAye: new BN(0),\n    votedNay: new BN(0),\n    votedTotal: new BN(0)\n  });\n}\n\nfunction calcVotesCurrent(tally, votes) {\n  const allAye = [];\n  const allNay = [];\n  votes.forEach(derived => {\n    if (derived.vote.isAye) {\n      allAye.push(derived);\n    } else {\n      allNay.push(derived);\n    }\n  });\n  return {\n    allAye,\n    allNay,\n    voteCount: allAye.length + allNay.length,\n    voteCountAye: allAye.length,\n    voteCountNay: allNay.length,\n    votedAye: tally.ayes,\n    votedNay: tally.nays,\n    votedTotal: tally.turnout\n  };\n}\n\nexport function calcVotes(sqrtElectorate, referendum, votes) {\n  const state = isCurrentStatus(referendum.status) ? calcVotesCurrent(referendum.status.tally, votes) : calcVotesPrev(votes);\n  return _objectSpread(_objectSpread({}, state), {}, {\n    isPassing: calcPassing(referendum.status.threshold, sqrtElectorate, state),\n    votes\n  });\n}\nexport function getStatus(info) {\n  if (info.isNone) {\n    return null;\n  }\n\n  const unwrapped = info.unwrap();\n\n  if (isOldInfo(unwrapped)) {\n    return unwrapped;\n  } else if (unwrapped.isOngoing) {\n    return unwrapped.asOngoing;\n  } // done, we don't include it here... only currently active\n\n\n  return null;\n}\n\nfunction constructProposal(api, [bytes, proposer, balance, at]) {\n  let proposal;\n\n  try {\n    proposal = api.registry.createType('Proposal', bytes.toU8a(true));\n  } catch (error) {\n    console.error(error);\n  }\n\n  return {\n    at,\n    balance,\n    proposal,\n    proposer\n  };\n}\n\nexport function parseImage(api, imageOpt) {\n  if (imageOpt.isNone) {\n    return;\n  }\n\n  if (isCurrentPreimage(api, imageOpt)) {\n    const status = imageOpt.unwrap();\n\n    if (status.isMissing) {\n      return;\n    }\n\n    const {\n      data,\n      deposit,\n      provider,\n      since\n    } = status.asAvailable;\n    return constructProposal(api, [data, provider, deposit, since]);\n  }\n\n  return constructProposal(api, imageOpt.unwrap());\n}","map":{"version":3,"sources":["/home/abubakar/Desktop/KeyStore-Thorchain/node_modules/@polkadot/api-derive/democracy/util.js"],"names":["_defineProperty","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","BN","bnSqrt","isOldInfo","info","proposalHash","isCurrentStatus","status","tally","isCurrentPreimage","api","imageOpt","query","democracy","dispatchQueue","compareRationals","n1","d1","n2","d2","q1","div","q2","lt","r1","mod","r2","isZero","calcPassingOther","threshold","sqrtElectorate","votedAye","votedNay","votedTotal","sqrtVoters","isSupermajorityapproval","calcPassing","state","isSimplemajority","gt","calcVotesPrev","votesFor","reduce","derived","balance","vote","isDefault","conviction","index","counted","muln","divn","isAye","allAye","voteCountAye","iadd","allNay","voteCountNay","voteCount","calcVotesCurrent","votes","ayes","nays","turnout","calcVotes","referendum","isPassing","getStatus","isNone","unwrapped","unwrap","isOngoing","asOngoing","constructProposal","bytes","proposer","at","proposal","registry","createType","toU8a","error","console","parseImage","isMissing","data","deposit","provider","since","asAvailable"],"mappings":"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","sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { BN, bnSqrt } from '@polkadot/util';\n\nfunction isOldInfo(info) {\n  return !!info.proposalHash;\n}\n\nfunction isCurrentStatus(status) {\n  return !!status.tally;\n}\n\nfunction isCurrentPreimage(api, imageOpt) {\n  return !!imageOpt && !api.query.democracy.dispatchQueue;\n}\n\nexport function compareRationals(n1, d1, n2, d2) {\n  while (true) {\n    const q1 = n1.div(d1);\n    const q2 = n2.div(d2);\n\n    if (q1.lt(q2)) {\n      return true;\n    } else if (q2.lt(q1)) {\n      return false;\n    }\n\n    const r1 = n1.mod(d1);\n    const r2 = n2.mod(d2);\n\n    if (r2.isZero()) {\n      return false;\n    } else if (r1.isZero()) {\n      return true;\n    }\n\n    n1 = d2;\n    n2 = d1;\n    d1 = r2;\n    d2 = r1;\n  }\n}\n\nfunction calcPassingOther(threshold, sqrtElectorate, {\n  votedAye,\n  votedNay,\n  votedTotal\n}) {\n  const sqrtVoters = bnSqrt(votedTotal);\n  return sqrtVoters.isZero() ? false : threshold.isSupermajorityapproval ? compareRationals(votedNay, sqrtVoters, votedAye, sqrtElectorate) : compareRationals(votedNay, sqrtElectorate, votedAye, sqrtVoters);\n}\n\nexport function calcPassing(threshold, sqrtElectorate, state) {\n  return threshold.isSimplemajority ? state.votedAye.gt(state.votedNay) : calcPassingOther(threshold, sqrtElectorate, state);\n}\n\nfunction calcVotesPrev(votesFor) {\n  return votesFor.reduce((state, derived) => {\n    const {\n      balance,\n      vote\n    } = derived;\n    const isDefault = vote.conviction.index === 0;\n    const counted = balance.muln(isDefault ? 1 : vote.conviction.index).divn(isDefault ? 10 : 1);\n\n    if (vote.isAye) {\n      state.allAye.push(derived);\n      state.voteCountAye++;\n      state.votedAye.iadd(counted);\n    } else {\n      state.allNay.push(derived);\n      state.voteCountNay++;\n      state.votedNay.iadd(counted);\n    }\n\n    state.voteCount++;\n    state.votedTotal.iadd(counted);\n    return state;\n  }, {\n    allAye: [],\n    allNay: [],\n    voteCount: 0,\n    voteCountAye: 0,\n    voteCountNay: 0,\n    votedAye: new BN(0),\n    votedNay: new BN(0),\n    votedTotal: new BN(0)\n  });\n}\n\nfunction calcVotesCurrent(tally, votes) {\n  const allAye = [];\n  const allNay = [];\n  votes.forEach(derived => {\n    if (derived.vote.isAye) {\n      allAye.push(derived);\n    } else {\n      allNay.push(derived);\n    }\n  });\n  return {\n    allAye,\n    allNay,\n    voteCount: allAye.length + allNay.length,\n    voteCountAye: allAye.length,\n    voteCountNay: allNay.length,\n    votedAye: tally.ayes,\n    votedNay: tally.nays,\n    votedTotal: tally.turnout\n  };\n}\n\nexport function calcVotes(sqrtElectorate, referendum, votes) {\n  const state = isCurrentStatus(referendum.status) ? calcVotesCurrent(referendum.status.tally, votes) : calcVotesPrev(votes);\n  return _objectSpread(_objectSpread({}, state), {}, {\n    isPassing: calcPassing(referendum.status.threshold, sqrtElectorate, state),\n    votes\n  });\n}\nexport function getStatus(info) {\n  if (info.isNone) {\n    return null;\n  }\n\n  const unwrapped = info.unwrap();\n\n  if (isOldInfo(unwrapped)) {\n    return unwrapped;\n  } else if (unwrapped.isOngoing) {\n    return unwrapped.asOngoing;\n  } // done, we don't include it here... only currently active\n\n\n  return null;\n}\n\nfunction constructProposal(api, [bytes, proposer, balance, at]) {\n  let proposal;\n\n  try {\n    proposal = api.registry.createType('Proposal', bytes.toU8a(true));\n  } catch (error) {\n    console.error(error);\n  }\n\n  return {\n    at,\n    balance,\n    proposal,\n    proposer\n  };\n}\n\nexport function parseImage(api, imageOpt) {\n  if (imageOpt.isNone) {\n    return;\n  }\n\n  if (isCurrentPreimage(api, imageOpt)) {\n    const status = imageOpt.unwrap();\n\n    if (status.isMissing) {\n      return;\n    }\n\n    const {\n      data,\n      deposit,\n      provider,\n      since\n    } = status.asAvailable;\n    return constructProposal(api, [data, provider, deposit, since]);\n  }\n\n  return constructProposal(api, imageOpt.unwrap());\n}"]},"metadata":{},"sourceType":"module"}