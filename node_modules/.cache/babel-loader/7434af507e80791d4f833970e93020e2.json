{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.voteOption = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _big = _interopRequireDefault(require(\"big.js\"));\n\nvar crypto = _interopRequireWildcard(require(\"../../crypto\"));\n\nvar _types = require(\"../../types\");\n\nvar _validateHelper = require(\"../../utils/validateHelper\");\n\nvar _proposalType = _interopRequireDefault(require(\"./proposalType\")); // This is a circular dependecy; should be changed to `import type` asap\n\n\nvar BASENUMBER = Math.pow(10, 8);\nvar proposalTypeMapping = {\n  0x04: \"ListTradingPair\",\n  0x00: \"Nil\",\n  0x01: \"Text\",\n  0x02: \"ParameterChange\",\n  0x03: \"SoftwareUpgrade\",\n  0x05: \"FeeChange\",\n  0x06: \"CreateValidator\",\n  0x07: \"RemoveValidator\"\n};\n/**\n * VoteOption\n * @ignore\n * @example\n * OptionEmpty - 0x00\n * OptionYes - 0x01\n * OptionAbstain - 0x02\n * OptionNo - 0x03\n * OptionNoWithVeto - 0x04\n */\n\nvar voteOption = {\n  OptionEmpty: 0x00,\n  OptionYes: 0x01,\n  OptionAbstain: 0x02,\n  OptionNo: 0x03,\n  OptionNoWithVeto: 0x04\n};\nexports.voteOption = voteOption;\nvar voteOptionMapping = {\n  0x00: \"Empty\",\n  0x01: \"Yes\",\n  0x02: \"Abstain\",\n  0x03: \"No\",\n  0x04: \"NoWithVeto\"\n};\n\nvar Gov = /*#__PURE__*/function () {\n  /**\n   * @param {Object} bncClient\n   */\n  function Gov(bncClient) {\n    (0, _classCallCheck2[\"default\"])(this, Gov);\n    (0, _defineProperty2[\"default\"])(this, \"_bncClient\", void 0);\n\n    if (!Gov.instance) {\n      this._bncClient = bncClient;\n      Gov.instance = this;\n    }\n\n    return Gov.instance;\n  }\n  /**\n   * Submit a list proposal along with an initial deposit\n   * @param {Object} listParams\n   * @example\n   * var listParams = {\n   *  title: 'New trading pair',\n   *  description: '',\n   *  baseAsset: 'BTC',\n   *  quoteAsset: 'BNB',\n   *  initPrice: 1,\n   *  address: '',\n   *  initialDeposit: 2000,\n   *  expireTime: 1570665600,\n   *  votingPeriod: 604800\n   * }\n   */\n\n\n  (0, _createClass2[\"default\"])(Gov, [{\n    key: \"submitListProposal\",\n    value: function () {\n      var _submitListProposal = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(listParams) {\n        var listTradingPairObj, description, address, title, initialDeposit, votingPeriod;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                listTradingPairObj = {\n                  base_asset_symbol: listParams.baseAsset,\n                  quote_asset_symbol: listParams.quoteAsset,\n                  init_price: +new _big[\"default\"](listParams.initPrice).mul(BASENUMBER).toString(),\n                  description: listParams.description,\n                  expire_time: new Date(listParams.expireTime).toISOString()\n                };\n                description = JSON.stringify(listTradingPairObj);\n                address = listParams.address, title = listParams.title, initialDeposit = listParams.initialDeposit, votingPeriod = listParams.votingPeriod;\n                _context.next = 5;\n                return this.submitProposal(address, title, description, _proposalType[\"default\"].ProposalTypeListTradingPair, initialDeposit, votingPeriod);\n\n              case 5:\n                return _context.abrupt(\"return\", _context.sent);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function submitListProposal(_x) {\n        return _submitListProposal.apply(this, arguments);\n      }\n\n      return submitListProposal;\n    }()\n    /**\n     * Submit a proposal along with an initial deposit.\n     * Proposal title, description, type and deposit can\n     * be given directly or through a proposal JSON file.\n     * @param {String} address\n     * @param {String} title\n     * @param {String} description\n     * @param {Number} proposalType\n     * @param {Number} initialDeposit\n     * @param {String} votingPeriod\n     * @return {Promise} resolves with response (success or fail)\n     */\n\n  }, {\n    key: \"submitProposal\",\n    value: function () {\n      var _submitProposal = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(address, title, description, proposalType, initialDeposit, votingPeriod) {\n        var accAddress, coins, proposalMsg, signMsg, signedTx;\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                accAddress = crypto.decodeAddress(address);\n                coins = [{\n                  denom: \"BNB\",\n                  amount: new _big[\"default\"](initialDeposit).mul(BASENUMBER).toString()\n                }];\n                votingPeriod = +new _big[\"default\"](votingPeriod).mul(Math.pow(10, 9)).toString();\n                proposalMsg = {\n                  title: title,\n                  description: description,\n                  proposal_type: proposalType,\n                  proposer: accAddress,\n                  initial_deposit: [{\n                    denom: \"BNB\",\n                    amount: +new _big[\"default\"](initialDeposit).mul(BASENUMBER).toString()\n                  }],\n                  voting_period: votingPeriod,\n                  aminoPrefix: _types.AminoPrefix.MsgSubmitProposal\n                };\n                signMsg = {\n                  description: description,\n                  initial_deposit: coins,\n                  proposal_type: proposalTypeMapping[proposalType],\n                  proposer: address,\n                  title: title,\n                  voting_period: votingPeriod.toString()\n                };\n                _context2.next = 7;\n                return this._bncClient._prepareTransaction(proposalMsg, signMsg, address);\n\n              case 7:\n                signedTx = _context2.sent;\n                return _context2.abrupt(\"return\", this._bncClient._broadcastDelegate(signedTx));\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function submitProposal(_x2, _x3, _x4, _x5, _x6, _x7) {\n        return _submitProposal.apply(this, arguments);\n      }\n\n      return submitProposal;\n    }()\n    /**\n     * Deposit tokens for activing proposal\n     * @param {Number} proposalId\n     * @param {String} address\n     * @param {Array} coins\n     * @example\n     * var coins = [{\n     *   \"denom\": \"BNB\",\n     *   \"amount\": 10\n     * }]\n     */\n\n  }, {\n    key: \"deposit\",\n    value: function () {\n      var _deposit = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(proposalId, address, coins) {\n        var accAddress, amount, depositMsg, signMsg, signedTx;\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                accAddress = crypto.decodeAddress(address);\n                (0, _validateHelper.checkCoins)(coins);\n                amount = [];\n                coins.forEach(function (coin) {\n                  amount.push({\n                    denom: coin.denom,\n                    amount: +new _big[\"default\"](coin.amount).mul(BASENUMBER).toString()\n                  });\n                });\n                depositMsg = {\n                  proposal_id: proposalId,\n                  depositer: accAddress,\n                  amount: amount,\n                  aminoPrefix: _types.AminoPrefix.MsgDeposit\n                };\n                signMsg = {\n                  amount: amount.map(function (coin) {\n                    return {\n                      denom: coin.denom,\n                      amount: String(coin.amount)\n                    };\n                  }),\n                  depositer: address,\n                  proposal_id: String(proposalId)\n                };\n                _context3.next = 8;\n                return this._bncClient._prepareTransaction(depositMsg, signMsg, address);\n\n              case 8:\n                signedTx = _context3.sent;\n                return _context3.abrupt(\"return\", this._bncClient._broadcastDelegate(signedTx));\n\n              case 10:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function deposit(_x8, _x9, _x10) {\n        return _deposit.apply(this, arguments);\n      }\n\n      return deposit;\n    }()\n    /**\n     *\n     * @param {Number} proposalId\n     * @param {String} voter\n     * @param {VoteOption} option\n     */\n\n  }, {\n    key: \"vote\",\n    value: function () {\n      var _vote = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(proposalId, voter, option) {\n        var accAddress, voteMsg, signMsg, signedTx;\n        return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                accAddress = crypto.decodeAddress(voter);\n                voteMsg = {\n                  proposal_id: proposalId,\n                  voter: accAddress,\n                  option: option,\n                  aminoPrefix: _types.AminoPrefix.MsgVote\n                };\n                signMsg = {\n                  option: voteOptionMapping[option],\n                  proposal_id: String(proposalId),\n                  voter: voter\n                };\n                _context4.next = 5;\n                return this._bncClient._prepareTransaction(voteMsg, signMsg, voter);\n\n              case 5:\n                signedTx = _context4.sent;\n                return _context4.abrupt(\"return\", this._bncClient._broadcastDelegate(signedTx));\n\n              case 7:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function vote(_x11, _x12, _x13) {\n        return _vote.apply(this, arguments);\n      }\n\n      return vote;\n    }()\n  }]);\n  return Gov;\n}();\n\n(0, _defineProperty2[\"default\"])(Gov, \"instance\", void 0);\nvar _default = Gov;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/home/abubakar/Desktop/KeyStore-Thorchain/node_modules/@binance-chain/javascript-sdk/lib/client/gov/index.js"],"names":["_interopRequireWildcard","require","_interopRequireDefault","Object","defineProperty","exports","value","voteOption","_regenerator","_asyncToGenerator2","_classCallCheck2","_createClass2","_defineProperty2","_big","crypto","_types","_validateHelper","_proposalType","BASENUMBER","Math","pow","proposalTypeMapping","OptionEmpty","OptionYes","OptionAbstain","OptionNo","OptionNoWithVeto","voteOptionMapping","Gov","bncClient","instance","_bncClient","key","_submitListProposal","mark","_callee","listParams","listTradingPairObj","description","address","title","initialDeposit","votingPeriod","wrap","_callee$","_context","prev","next","base_asset_symbol","baseAsset","quote_asset_symbol","quoteAsset","init_price","initPrice","mul","toString","expire_time","Date","expireTime","toISOString","JSON","stringify","submitProposal","ProposalTypeListTradingPair","abrupt","sent","stop","submitListProposal","_x","apply","arguments","_submitProposal","_callee2","proposalType","accAddress","coins","proposalMsg","signMsg","signedTx","_callee2$","_context2","decodeAddress","denom","amount","proposal_type","proposer","initial_deposit","voting_period","aminoPrefix","AminoPrefix","MsgSubmitProposal","_prepareTransaction","_broadcastDelegate","_x2","_x3","_x4","_x5","_x6","_x7","_deposit","_callee3","proposalId","depositMsg","_callee3$","_context3","checkCoins","forEach","coin","push","proposal_id","depositer","MsgDeposit","map","String","deposit","_x8","_x9","_x10","_vote","_callee4","voter","option","voteMsg","_callee4$","_context4","MsgVote","vote","_x11","_x12","_x13","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.voteOption = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _big = _interopRequireDefault(require(\"big.js\"));\n\nvar crypto = _interopRequireWildcard(require(\"../../crypto\"));\n\nvar _types = require(\"../../types\");\n\nvar _validateHelper = require(\"../../utils/validateHelper\");\n\nvar _proposalType = _interopRequireDefault(require(\"./proposalType\"));\n\n// This is a circular dependecy; should be changed to `import type` asap\nvar BASENUMBER = Math.pow(10, 8);\nvar proposalTypeMapping = {\n  0x04: \"ListTradingPair\",\n  0x00: \"Nil\",\n  0x01: \"Text\",\n  0x02: \"ParameterChange\",\n  0x03: \"SoftwareUpgrade\",\n  0x05: \"FeeChange\",\n  0x06: \"CreateValidator\",\n  0x07: \"RemoveValidator\"\n};\n/**\n * VoteOption\n * @ignore\n * @example\n * OptionEmpty - 0x00\n * OptionYes - 0x01\n * OptionAbstain - 0x02\n * OptionNo - 0x03\n * OptionNoWithVeto - 0x04\n */\n\nvar voteOption = {\n  OptionEmpty: 0x00,\n  OptionYes: 0x01,\n  OptionAbstain: 0x02,\n  OptionNo: 0x03,\n  OptionNoWithVeto: 0x04\n};\nexports.voteOption = voteOption;\nvar voteOptionMapping = {\n  0x00: \"Empty\",\n  0x01: \"Yes\",\n  0x02: \"Abstain\",\n  0x03: \"No\",\n  0x04: \"NoWithVeto\"\n};\n\nvar Gov = /*#__PURE__*/function () {\n  /**\n   * @param {Object} bncClient\n   */\n  function Gov(bncClient) {\n    (0, _classCallCheck2[\"default\"])(this, Gov);\n    (0, _defineProperty2[\"default\"])(this, \"_bncClient\", void 0);\n\n    if (!Gov.instance) {\n      this._bncClient = bncClient;\n      Gov.instance = this;\n    }\n\n    return Gov.instance;\n  }\n  /**\n   * Submit a list proposal along with an initial deposit\n   * @param {Object} listParams\n   * @example\n   * var listParams = {\n   *  title: 'New trading pair',\n   *  description: '',\n   *  baseAsset: 'BTC',\n   *  quoteAsset: 'BNB',\n   *  initPrice: 1,\n   *  address: '',\n   *  initialDeposit: 2000,\n   *  expireTime: 1570665600,\n   *  votingPeriod: 604800\n   * }\n   */\n\n\n  (0, _createClass2[\"default\"])(Gov, [{\n    key: \"submitListProposal\",\n    value: function () {\n      var _submitListProposal = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(listParams) {\n        var listTradingPairObj, description, address, title, initialDeposit, votingPeriod;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                listTradingPairObj = {\n                  base_asset_symbol: listParams.baseAsset,\n                  quote_asset_symbol: listParams.quoteAsset,\n                  init_price: +new _big[\"default\"](listParams.initPrice).mul(BASENUMBER).toString(),\n                  description: listParams.description,\n                  expire_time: new Date(listParams.expireTime).toISOString()\n                };\n                description = JSON.stringify(listTradingPairObj);\n                address = listParams.address, title = listParams.title, initialDeposit = listParams.initialDeposit, votingPeriod = listParams.votingPeriod;\n                _context.next = 5;\n                return this.submitProposal(address, title, description, _proposalType[\"default\"].ProposalTypeListTradingPair, initialDeposit, votingPeriod);\n\n              case 5:\n                return _context.abrupt(\"return\", _context.sent);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function submitListProposal(_x) {\n        return _submitListProposal.apply(this, arguments);\n      }\n\n      return submitListProposal;\n    }()\n    /**\n     * Submit a proposal along with an initial deposit.\n     * Proposal title, description, type and deposit can\n     * be given directly or through a proposal JSON file.\n     * @param {String} address\n     * @param {String} title\n     * @param {String} description\n     * @param {Number} proposalType\n     * @param {Number} initialDeposit\n     * @param {String} votingPeriod\n     * @return {Promise} resolves with response (success or fail)\n     */\n\n  }, {\n    key: \"submitProposal\",\n    value: function () {\n      var _submitProposal = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(address, title, description, proposalType, initialDeposit, votingPeriod) {\n        var accAddress, coins, proposalMsg, signMsg, signedTx;\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                accAddress = crypto.decodeAddress(address);\n                coins = [{\n                  denom: \"BNB\",\n                  amount: new _big[\"default\"](initialDeposit).mul(BASENUMBER).toString()\n                }];\n                votingPeriod = +new _big[\"default\"](votingPeriod).mul(Math.pow(10, 9)).toString();\n                proposalMsg = {\n                  title: title,\n                  description: description,\n                  proposal_type: proposalType,\n                  proposer: accAddress,\n                  initial_deposit: [{\n                    denom: \"BNB\",\n                    amount: +new _big[\"default\"](initialDeposit).mul(BASENUMBER).toString()\n                  }],\n                  voting_period: votingPeriod,\n                  aminoPrefix: _types.AminoPrefix.MsgSubmitProposal\n                };\n                signMsg = {\n                  description: description,\n                  initial_deposit: coins,\n                  proposal_type: proposalTypeMapping[proposalType],\n                  proposer: address,\n                  title: title,\n                  voting_period: votingPeriod.toString()\n                };\n                _context2.next = 7;\n                return this._bncClient._prepareTransaction(proposalMsg, signMsg, address);\n\n              case 7:\n                signedTx = _context2.sent;\n                return _context2.abrupt(\"return\", this._bncClient._broadcastDelegate(signedTx));\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function submitProposal(_x2, _x3, _x4, _x5, _x6, _x7) {\n        return _submitProposal.apply(this, arguments);\n      }\n\n      return submitProposal;\n    }()\n    /**\n     * Deposit tokens for activing proposal\n     * @param {Number} proposalId\n     * @param {String} address\n     * @param {Array} coins\n     * @example\n     * var coins = [{\n     *   \"denom\": \"BNB\",\n     *   \"amount\": 10\n     * }]\n     */\n\n  }, {\n    key: \"deposit\",\n    value: function () {\n      var _deposit = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(proposalId, address, coins) {\n        var accAddress, amount, depositMsg, signMsg, signedTx;\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                accAddress = crypto.decodeAddress(address);\n                (0, _validateHelper.checkCoins)(coins);\n                amount = [];\n                coins.forEach(function (coin) {\n                  amount.push({\n                    denom: coin.denom,\n                    amount: +new _big[\"default\"](coin.amount).mul(BASENUMBER).toString()\n                  });\n                });\n                depositMsg = {\n                  proposal_id: proposalId,\n                  depositer: accAddress,\n                  amount: amount,\n                  aminoPrefix: _types.AminoPrefix.MsgDeposit\n                };\n                signMsg = {\n                  amount: amount.map(function (coin) {\n                    return {\n                      denom: coin.denom,\n                      amount: String(coin.amount)\n                    };\n                  }),\n                  depositer: address,\n                  proposal_id: String(proposalId)\n                };\n                _context3.next = 8;\n                return this._bncClient._prepareTransaction(depositMsg, signMsg, address);\n\n              case 8:\n                signedTx = _context3.sent;\n                return _context3.abrupt(\"return\", this._bncClient._broadcastDelegate(signedTx));\n\n              case 10:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function deposit(_x8, _x9, _x10) {\n        return _deposit.apply(this, arguments);\n      }\n\n      return deposit;\n    }()\n    /**\n     *\n     * @param {Number} proposalId\n     * @param {String} voter\n     * @param {VoteOption} option\n     */\n\n  }, {\n    key: \"vote\",\n    value: function () {\n      var _vote = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(proposalId, voter, option) {\n        var accAddress, voteMsg, signMsg, signedTx;\n        return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                accAddress = crypto.decodeAddress(voter);\n                voteMsg = {\n                  proposal_id: proposalId,\n                  voter: accAddress,\n                  option: option,\n                  aminoPrefix: _types.AminoPrefix.MsgVote\n                };\n                signMsg = {\n                  option: voteOptionMapping[option],\n                  proposal_id: String(proposalId),\n                  voter: voter\n                };\n                _context4.next = 5;\n                return this._bncClient._prepareTransaction(voteMsg, signMsg, voter);\n\n              case 5:\n                signedTx = _context4.sent;\n                return _context4.abrupt(\"return\", this._bncClient._broadcastDelegate(signedTx));\n\n              case 7:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function vote(_x11, _x12, _x13) {\n        return _vote.apply(this, arguments);\n      }\n\n      return vote;\n    }()\n  }]);\n  return Gov;\n}();\n\n(0, _defineProperty2[\"default\"])(Gov, \"instance\", void 0);\nvar _default = Gov;\nexports[\"default\"] = _default;"]},"metadata":{},"sourceType":"script"}