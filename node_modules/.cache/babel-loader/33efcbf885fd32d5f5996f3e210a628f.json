{"ast":null,"code":"// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { map, startWith, switchMap } from 'rxjs';\nimport { drr, memo } from \"../util/index.js\";\n\nfunction onBondedEvent(api) {\n  let current = Date.now();\n  return api.query.system.events().pipe(map(events => {\n    current = events.filter(({\n      event,\n      phase\n    }) => {\n      try {\n        return phase.isApplyExtrinsic && event.section === 'staking' && event.method === 'Bonded';\n      } catch {\n        return false;\n      }\n    }) ? Date.now() : current;\n    return current;\n  }), startWith(current), drr({\n    skipTimeout: true\n  }));\n}\n/**\n * @description Retrieve the list of all validator stashes\n */\n\n\nexport function stashes(instanceId, api) {\n  return memo(instanceId, () => onBondedEvent(api).pipe(switchMap(() => api.query.staking.validators.keys()), map(keys => keys.map(({\n    args: [validatorId]\n  }) => validatorId).filter(a => a))));\n}","map":{"version":3,"sources":["/home/abubakar/Desktop/KeyStore-Thorchain/node_modules/@polkadot/api-derive/staking/stashes.js"],"names":["map","startWith","switchMap","drr","memo","onBondedEvent","api","current","Date","now","query","system","events","pipe","filter","event","phase","isApplyExtrinsic","section","method","skipTimeout","stashes","instanceId","staking","validators","keys","args","validatorId","a"],"mappings":"AAAA;AACA;AACA,SAASA,GAAT,EAAcC,SAAd,EAAyBC,SAAzB,QAA0C,MAA1C;AACA,SAASC,GAAT,EAAcC,IAAd,QAA0B,kBAA1B;;AAEA,SAASC,aAAT,CAAuBC,GAAvB,EAA4B;AAC1B,MAAIC,OAAO,GAAGC,IAAI,CAACC,GAAL,EAAd;AACA,SAAOH,GAAG,CAACI,KAAJ,CAAUC,MAAV,CAAiBC,MAAjB,GAA0BC,IAA1B,CAA+Bb,GAAG,CAACY,MAAM,IAAI;AAClDL,IAAAA,OAAO,GAAGK,MAAM,CAACE,MAAP,CAAc,CAAC;AACvBC,MAAAA,KADuB;AAEvBC,MAAAA;AAFuB,KAAD,KAGlB;AACJ,UAAI;AACF,eAAOA,KAAK,CAACC,gBAAN,IAA0BF,KAAK,CAACG,OAAN,KAAkB,SAA5C,IAAyDH,KAAK,CAACI,MAAN,KAAiB,QAAjF;AACD,OAFD,CAEE,MAAM;AACN,eAAO,KAAP;AACD;AACF,KATS,IASLX,IAAI,CAACC,GAAL,EATK,GASQF,OATlB;AAUA,WAAOA,OAAP;AACD,GAZwC,CAAlC,EAYHN,SAAS,CAACM,OAAD,CAZN,EAYiBJ,GAAG,CAAC;AAC1BiB,IAAAA,WAAW,EAAE;AADa,GAAD,CAZpB,CAAP;AAeD;AACD;AACA;AACA;;;AAGA,OAAO,SAASC,OAAT,CAAiBC,UAAjB,EAA6BhB,GAA7B,EAAkC;AACvC,SAAOF,IAAI,CAACkB,UAAD,EAAa,MAAMjB,aAAa,CAACC,GAAD,CAAb,CAAmBO,IAAnB,CAAwBX,SAAS,CAAC,MAAMI,GAAG,CAACI,KAAJ,CAAUa,OAAV,CAAkBC,UAAlB,CAA6BC,IAA7B,EAAP,CAAjC,EAA8EzB,GAAG,CAACyB,IAAI,IAAIA,IAAI,CAACzB,GAAL,CAAS,CAAC;AAChI0B,IAAAA,IAAI,EAAE,CAACC,WAAD;AAD0H,GAAD,KAE3HA,WAFkH,EAErGb,MAFqG,CAE9Fc,CAAC,IAAIA,CAFyF,CAAT,CAAjF,CAAnB,CAAX;AAGD","sourcesContent":["// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { map, startWith, switchMap } from 'rxjs';\nimport { drr, memo } from \"../util/index.js\";\n\nfunction onBondedEvent(api) {\n  let current = Date.now();\n  return api.query.system.events().pipe(map(events => {\n    current = events.filter(({\n      event,\n      phase\n    }) => {\n      try {\n        return phase.isApplyExtrinsic && event.section === 'staking' && event.method === 'Bonded';\n      } catch {\n        return false;\n      }\n    }) ? Date.now() : current;\n    return current;\n  }), startWith(current), drr({\n    skipTimeout: true\n  }));\n}\n/**\n * @description Retrieve the list of all validator stashes\n */\n\n\nexport function stashes(instanceId, api) {\n  return memo(instanceId, () => onBondedEvent(api).pipe(switchMap(() => api.query.staking.validators.keys()), map(keys => keys.map(({\n    args: [validatorId]\n  }) => validatorId).filter(a => a))));\n}"]},"metadata":{},"sourceType":"module"}