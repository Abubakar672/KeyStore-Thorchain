{"ast":null,"code":"// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { isHex, u8aToString } from '@polkadot/util';\nimport { memo } from \"../util/index.js\";\nconst UNDEF_HEX = {\n  toHex: () => undefined\n};\n\nfunction dataAsString(data) {\n  return data.isRaw ? u8aToString(data.asRaw.toU8a(true)) : data.isNone ? undefined : data.toHex();\n}\n\nfunction extractOther(additional) {\n  return additional.reduce((other, [_key, _value]) => {\n    const key = dataAsString(_key);\n    const value = dataAsString(_value);\n\n    if (key && value) {\n      other[key] = value;\n    }\n\n    return other;\n  }, {});\n}\n\nfunction extractIdentity(identityOfOpt, superOf) {\n  if (!(identityOfOpt !== null && identityOfOpt !== void 0 && identityOfOpt.isSome)) {\n    return {\n      judgements: []\n    };\n  }\n\n  const {\n    info,\n    judgements\n  } = identityOfOpt.unwrap();\n  const topDisplay = dataAsString(info.display);\n  return {\n    display: superOf && dataAsString(superOf[1]) || topDisplay,\n    displayParent: superOf && topDisplay,\n    email: dataAsString(info.email),\n    image: dataAsString(info.image),\n    judgements,\n    legal: dataAsString(info.legal),\n    other: extractOther(info.additional),\n    parent: superOf && superOf[0],\n    pgp: info.pgpFingerprint.unwrapOr(UNDEF_HEX).toHex(),\n    riot: dataAsString(info.riot),\n    twitter: dataAsString(info.twitter),\n    web: dataAsString(info.web)\n  };\n}\n\nfunction getParent(api, identityOfOpt, superOfOpt) {\n  if (identityOfOpt !== null && identityOfOpt !== void 0 && identityOfOpt.isSome) {\n    // this identity has something set\n    return of([identityOfOpt, undefined]);\n  } else if (superOfOpt !== null && superOfOpt !== void 0 && superOfOpt.isSome) {\n    const superOf = superOfOpt.unwrap(); // we have a super\n\n    return combineLatest([api.query.identity.identityOf(superOf[0]), of(superOf)]);\n  } // nothing of value returned\n\n\n  return of([undefined, undefined]);\n}\n\nfunction getBase(api, accountId) {\n  var _api$query$identity;\n\n  return accountId && (_api$query$identity = api.query.identity) !== null && _api$query$identity !== void 0 && _api$query$identity.identityOf ? api.queryMulti([[api.query.identity.identityOf, accountId], [api.query.identity.superOf, accountId]]) : of([undefined, undefined]);\n}\n/**\n * @name identity\n * @description Returns identity info for an account\n */\n\n\nexport function identity(instanceId, api) {\n  return memo(instanceId, accountId => getBase(api, accountId).pipe(switchMap(([identityOfOpt, superOfOpt]) => getParent(api, identityOfOpt, superOfOpt)), map(([identityOfOpt, superOf]) => extractIdentity(identityOfOpt, superOf))));\n}\nexport function hasIdentity(instanceId, api) {\n  return memo(instanceId, accountId => api.derive.accounts.hasIdentityMulti([accountId]).pipe(map(([first]) => first)));\n}\nexport function hasIdentityMulti(instanceId, api) {\n  return memo(instanceId, accountIds => {\n    var _api$query$identity2;\n\n    return (_api$query$identity2 = api.query.identity) !== null && _api$query$identity2 !== void 0 && _api$query$identity2.identityOf ? combineLatest([api.query.identity.identityOf.multi(accountIds), api.query.identity.superOf.multi(accountIds)]).pipe(map(([identities, supers]) => identities.map((identityOfOpt, index) => {\n      const superOfOpt = supers[index];\n      const parentId = superOfOpt && superOfOpt.isSome ? superOfOpt.unwrap()[0].toString() : undefined;\n      let display;\n\n      if (identityOfOpt && identityOfOpt.isSome) {\n        const value = dataAsString(identityOfOpt.unwrap().info.display);\n\n        if (value && !isHex(value)) {\n          display = value;\n        }\n      }\n\n      return {\n        display,\n        hasIdentity: !!(display || parentId),\n        parentId\n      };\n    }))) : of(accountIds.map(() => ({\n      hasIdentity: false\n    })));\n  });\n}","map":{"version":3,"sources":["/home/abubakar/Desktop/KeyStore-Thorchain/node_modules/@polkadot/api-derive/accounts/identity.js"],"names":["combineLatest","map","of","switchMap","isHex","u8aToString","memo","UNDEF_HEX","toHex","undefined","dataAsString","data","isRaw","asRaw","toU8a","isNone","extractOther","additional","reduce","other","_key","_value","key","value","extractIdentity","identityOfOpt","superOf","isSome","judgements","info","unwrap","topDisplay","display","displayParent","email","image","legal","parent","pgp","pgpFingerprint","unwrapOr","riot","twitter","web","getParent","api","superOfOpt","query","identity","identityOf","getBase","accountId","_api$query$identity","queryMulti","instanceId","pipe","hasIdentity","derive","accounts","hasIdentityMulti","first","accountIds","_api$query$identity2","multi","identities","supers","index","parentId","toString"],"mappings":"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","sourcesContent":["// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, map, of, switchMap } from 'rxjs';\nimport { isHex, u8aToString } from '@polkadot/util';\nimport { memo } from \"../util/index.js\";\nconst UNDEF_HEX = {\n  toHex: () => undefined\n};\n\nfunction dataAsString(data) {\n  return data.isRaw ? u8aToString(data.asRaw.toU8a(true)) : data.isNone ? undefined : data.toHex();\n}\n\nfunction extractOther(additional) {\n  return additional.reduce((other, [_key, _value]) => {\n    const key = dataAsString(_key);\n    const value = dataAsString(_value);\n\n    if (key && value) {\n      other[key] = value;\n    }\n\n    return other;\n  }, {});\n}\n\nfunction extractIdentity(identityOfOpt, superOf) {\n  if (!(identityOfOpt !== null && identityOfOpt !== void 0 && identityOfOpt.isSome)) {\n    return {\n      judgements: []\n    };\n  }\n\n  const {\n    info,\n    judgements\n  } = identityOfOpt.unwrap();\n  const topDisplay = dataAsString(info.display);\n  return {\n    display: superOf && dataAsString(superOf[1]) || topDisplay,\n    displayParent: superOf && topDisplay,\n    email: dataAsString(info.email),\n    image: dataAsString(info.image),\n    judgements,\n    legal: dataAsString(info.legal),\n    other: extractOther(info.additional),\n    parent: superOf && superOf[0],\n    pgp: info.pgpFingerprint.unwrapOr(UNDEF_HEX).toHex(),\n    riot: dataAsString(info.riot),\n    twitter: dataAsString(info.twitter),\n    web: dataAsString(info.web)\n  };\n}\n\nfunction getParent(api, identityOfOpt, superOfOpt) {\n  if (identityOfOpt !== null && identityOfOpt !== void 0 && identityOfOpt.isSome) {\n    // this identity has something set\n    return of([identityOfOpt, undefined]);\n  } else if (superOfOpt !== null && superOfOpt !== void 0 && superOfOpt.isSome) {\n    const superOf = superOfOpt.unwrap(); // we have a super\n\n    return combineLatest([api.query.identity.identityOf(superOf[0]), of(superOf)]);\n  } // nothing of value returned\n\n\n  return of([undefined, undefined]);\n}\n\nfunction getBase(api, accountId) {\n  var _api$query$identity;\n\n  return accountId && (_api$query$identity = api.query.identity) !== null && _api$query$identity !== void 0 && _api$query$identity.identityOf ? api.queryMulti([[api.query.identity.identityOf, accountId], [api.query.identity.superOf, accountId]]) : of([undefined, undefined]);\n}\n/**\n * @name identity\n * @description Returns identity info for an account\n */\n\n\nexport function identity(instanceId, api) {\n  return memo(instanceId, accountId => getBase(api, accountId).pipe(switchMap(([identityOfOpt, superOfOpt]) => getParent(api, identityOfOpt, superOfOpt)), map(([identityOfOpt, superOf]) => extractIdentity(identityOfOpt, superOf))));\n}\nexport function hasIdentity(instanceId, api) {\n  return memo(instanceId, accountId => api.derive.accounts.hasIdentityMulti([accountId]).pipe(map(([first]) => first)));\n}\nexport function hasIdentityMulti(instanceId, api) {\n  return memo(instanceId, accountIds => {\n    var _api$query$identity2;\n\n    return (_api$query$identity2 = api.query.identity) !== null && _api$query$identity2 !== void 0 && _api$query$identity2.identityOf ? combineLatest([api.query.identity.identityOf.multi(accountIds), api.query.identity.superOf.multi(accountIds)]).pipe(map(([identities, supers]) => identities.map((identityOfOpt, index) => {\n      const superOfOpt = supers[index];\n      const parentId = superOfOpt && superOfOpt.isSome ? superOfOpt.unwrap()[0].toString() : undefined;\n      let display;\n\n      if (identityOfOpt && identityOfOpt.isSome) {\n        const value = dataAsString(identityOfOpt.unwrap().info.display);\n\n        if (value && !isHex(value)) {\n          display = value;\n        }\n      }\n\n      return {\n        display,\n        hasIdentity: !!(display || parentId),\n        parentId\n      };\n    }))) : of(accountIds.map(() => ({\n      hasIdentity: false\n    })));\n  });\n}"]},"metadata":{},"sourceType":"module"}